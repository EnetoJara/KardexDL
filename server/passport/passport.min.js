var LocalStrategy=require("passport-local").Strategy,mysql=require("mysql"),bcrypt=require("bcryptjs");module.exports=function(e){e.serializeUser(function(e,r){r(null,e)}),e.deserializeUser(function(e,r){r(null,e)}),e.use(new LocalStrategy({passReqToCallback:!0},function(e,r,a,t){var i=require(".././database/config"),n=mysql.createConnection(i);n.connect(),n.query("CALL GET_USUARIO(?);",r,function(r,i){if(r)throw r;if(n.end(),i[0].length>0){var s=i[0],p=bcrypt.compareSync(a,s[0].PSSWRD);return p?t(null,{id:s[0].ID,idRole:s[0].ROLE_ID,nombre:s[0].NOMBRE,role:s[0].ROLE,usuario:s[0].USUARIO,carrera:s[0].CARRERA,idCarrera:s[0].CARRERA_ID}):t(null,!1,e.flash("authmessage","La Matricula o La Contraseña son incorrectos."))}return t(null,!1,e.flash("authmessage","La Matricula o La Contraseña son incorrectos."))})}))};